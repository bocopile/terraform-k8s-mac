# KEDA (Kubernetes Event-Driven Autoscaling) Helm Values
# Enables event-driven autoscaling based on external metrics and events

# Global settings
fullnameOverride: keda

# Image configuration
image:
  keda:
    registry: ghcr.io
    repository: kedacore/keda
    tag: 2.18.1
  metricsApiServer:
    registry: ghcr.io
    repository: kedacore/keda-metrics-apiserver
    tag: 2.18.1
  webhooks:
    registry: ghcr.io
    repository: kedacore/keda-admission-webhooks
    tag: 2.18.1

# Replicas
replicaCount: 1

# Resource limits
resources:
  operator:
    limits:
      cpu: 1000m
      memory: 1000Mi
    requests:
      cpu: 100m
      memory: 100Mi
  metricServer:
    limits:
      cpu: 1000m
      memory: 1000Mi
    requests:
      cpu: 100m
      memory: 100Mi
  webhooks:
    limits:
      cpu: 500m
      memory: 500Mi
    requests:
      cpu: 100m
      memory: 100Mi

# Service account
serviceAccount:
  create: true
  name: keda-operator
  annotations: {}

# RBAC
rbac:
  create: true

# Prometheus metrics
prometheus:
  metricServer:
    enabled: true
    port: 8080
    portName: metrics
    path: /metrics
    serviceMonitor:
      enabled: true
      namespace: keda
      interval: 30s
      scrapeTimeout: 10s
      additionalLabels:
        release: kube-prometheus-stack
  operator:
    enabled: true
    port: 8080
    portName: metrics
    path: /metrics
    serviceMonitor:
      enabled: true
      namespace: keda
      interval: 30s
      scrapeTimeout: 10s
      additionalLabels:
        release: kube-prometheus-stack
  webhooks:
    enabled: true
    port: 8080
    portName: metrics
    path: /metrics
    serviceMonitor:
      enabled: true
      namespace: keda
      interval: 30s
      scrapeTimeout: 10s
      additionalLabels:
        release: kube-prometheus-stack

# Pod security context
podSecurityContext:
  operator:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  metricServer:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  webhooks:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000

# Container security context
securityContext:
  operator:
    capabilities:
      drop:
        - ALL
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
  metricServer:
    capabilities:
      drop:
        - ALL
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
  webhooks:
    capabilities:
      drop:
        - ALL
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true

# Logging level (debug, info, warn, error)
logging:
  operator:
    level: info
    format: json
  webhooks:
    level: info

# Pod annotations
podAnnotations:
  operator:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/metrics"
  metricServer:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/metrics"
  webhooks:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/metrics"

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Additional volumes (for cloud provider authentication, etc.)
volumes:
  keda:
    extraVolumes: []
    extraVolumeMounts: []

# HTTP timeout settings
http:
  timeout: 3000
  minTLSVersion: TLS12

# Certificate settings for webhooks
certificates:
  autoGenerated: true
  secretName: keda-webhooks-certs

# Leader election
leaderElection:
  operator:
    enabled: true

# Admission webhooks
admissionWebhooks:
  enabled: true
  failurePolicy: Ignore
  port: 9443

# Additional environment variables
env: []

# Priority class
priorityClassName: ""

# Upgrade strategy for each component
upgradeStrategy:
  operator:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  metricsApiServer:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  webhooks:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1

# Service configuration
service:
  type: ClusterIP
  portHttp: 8080
  portHttpTarget: 8080
  portHttps: 443
  portHttpsTarget: 6443
  annotations: {}

# Enable high availability for metrics server
metricsServer:
  useHostNetwork: false
  replicaCount: 1
  dnsPolicy: ClusterFirst

# Pod Disruption Budget
podDisruptionBudget:
  operator:
    enabled: false
    minAvailable: 1
  metricServer:
    enabled: false
    minAvailable: 1
  webhooks:
    enabled: false
    minAvailable: 1
