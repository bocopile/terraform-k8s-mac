# Fluent Bit 파서 설정
# 목적: 다양한 로그 형식을 파싱

# Docker JSON 파서
[PARSER]
    Name        docker
    Format      json
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# JSON 파서 (일반)
[PARSER]
    Name        json
    Format      json
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L
    Time_Keep   On

# Apache 로그 파서
[PARSER]
    Name        apache
    Format      regex
    Regex       ^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z
    Time_Keep   On

# Nginx 로그 파서
[PARSER]
    Name        nginx
    Format      regex
    Regex       ^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^\"]*?)(?: +\S*)?)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z
    Time_Keep   On

# Syslog 파서
[PARSER]
    Name        syslog
    Format      regex
    Regex       ^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$
    Time_Key    time
    Time_Format %b %d %H:%M:%S
    Time_Keep   On

# Kubernetes 파서
[PARSER]
    Name        kube
    Format      regex
    Regex       ^(?<time>[^ ]+) (?<stream>stdout|stderr) (?<logtag>[^ ]*) (?<log>.*)$
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# Go 로그 파서
[PARSER]
    Name        go
    Format      regex
    Regex       ^(?<time>[^ ]+) (?<level>[^ ]+) (?<message>.*)$
    Time_Key    time
    Time_Format %Y/%m/%d %H:%M:%S
    Time_Keep   On

# Java 스택트레이스 파서 (멀티라인)
[PARSER]
    Name        java_multiline
    Format      regex
    Regex       /^(?<time>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}.\d{3}) \[(?<thread>[^\]]+)\] (?<level>[^ ]+) +(?<class>[^ ]+) - (?<message>.*)/
    Time_Key    time
    Time_Format %Y-%m-%d %H:%M:%S.%L
    Time_Keep   On

# Python 로그 파서
[PARSER]
    Name        python
    Format      regex
    Regex       ^(?<time>[^ ]+) - (?<name>[^ ]+) - (?<level>[^ ]+) - (?<message>.*)$
    Time_Key    time
    Time_Format %Y-%m-%d %H:%M:%S,%L
    Time_Keep   On

# Spring Boot 로그 파서
[PARSER]
    Name        spring_boot
    Format      regex
    Regex       ^(?<time>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}.\d{3})\s+(?<level>[^ ]+)\s+(?<pid>\d+)\s+---\s+\[(?<thread>[^\]]+)\]\s+(?<class>[^ ]+)\s+:\s+(?<message>.*)$
    Time_Key    time
    Time_Format %Y-%m-%d %H:%M:%S.%L
    Time_Keep   On

# Redis 로그 파서
[PARSER]
    Name        redis
    Format      regex
    Regex       ^(?<pid>\d+):(?<role>[^ ]*) (?<time>[^ ]+ [^ ]+) (?<level>[.]) (?<message>.*)$
    Time_Key    time
    Time_Format %d %b %Y %H:%M:%S.%L
    Time_Keep   On

# MySQL 로그 파서
[PARSER]
    Name        mysql
    Format      regex
    Regex       ^(?<time>[^ ]+ [^ ]+) (?<thread>\d+) \[(?<level>[^\]]+)\] (?<message>.*)$
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# PostgreSQL 로그 파서
[PARSER]
    Name        postgresql
    Format      regex
    Regex       ^(?<time>[^ ]+ [^ ]+ [^ ]+) \[(?<pid>\d+)\] (?<level>[^ ]+):  (?<message>.*)$
    Time_Key    time
    Time_Format %Y-%m-%d %H:%M:%S.%L %Z
    Time_Keep   On
