# MinIO Helm Values
# S3-compatible object storage for Loki and Tempo
# Provides local development environment for S3 scenarios

# Deployment mode
mode: standalone  # Single instance mode

# Number of MinIO instances
replicas: 1

# Image configuration
image:
  repository: quay.io/minio/minio
  tag: RELEASE.2025-01-08T17-40-03Z
  pullPolicy: IfNotPresent

# Root credentials (change in production)
rootUser: minioadmin
rootPassword: minioadmin123

# Buckets to be created automatically
buckets:
  - name: loki-data
    policy: none
    purge: false
  - name: tempo-data
    policy: none
    purge: false

# Persistence configuration
persistence:
  enabled: true
  storageClass: local-path
  accessMode: ReadWriteOnce
  size: 50Gi

# Resource limits
resources:
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 1000m
    memory: 2Gi

# Service configuration
service:
  type: LoadBalancer
  port: 9000
  # Console port for web UI
  consolePort: 9001
  # Annotations for MetalLB
  annotations:
    metallb.universe.tf/loadBalancerIPs: 192.168.100.240

# Console ingress (optional)
consoleService:
  type: LoadBalancer
  port: 9001
  annotations:
    metallb.universe.tf/loadBalancerIPs: 192.168.100.241

# Security context
securityContext:
  enabled: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  runAsNonRoot: true

# Network policies
networkPolicy:
  enabled: false
  allowExternal: true

# Lifecycle policies (retention)
# Automatically delete data older than 30 days
policies:
  - name: loki-retention
    statements:
      - resource: arn:aws:s3:::loki-data/*
        effect: Allow
        actions:
          - s3:DeleteObject
        conditions:
          DateGreaterThan:
            s3:ExistingObjectTag/retention: "30d"
  - name: tempo-retention
    statements:
      - resource: arn:aws:s3:::tempo-data/*
        effect: Allow
        actions:
          - s3:DeleteObject
        conditions:
          DateGreaterThan:
            s3:ExistingObjectTag/retention: "30d"

# Monitoring
metrics:
  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9000"
  prometheus.io/path: "/minio/v2/metrics/cluster"

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules
affinity: {}

# Update strategy
DeploymentUpdate:
  type: RollingUpdate
  maxUnavailable: 0
  maxSurge: 100%

# Liveness probe
livenessProbe:
  httpGet:
    path: /minio/health/live
    port: 9000
    scheme: HTTP
  initialDelaySeconds: 120
  periodSeconds: 30
  timeoutSeconds: 10
  successThreshold: 1
  failureThreshold: 3

# Readiness probe
readinessProbe:
  httpGet:
    path: /minio/health/ready
    port: 9000
    scheme: HTTP
  initialDelaySeconds: 30
  periodSeconds: 15
  timeoutSeconds: 10
  successThreshold: 1
  failureThreshold: 3

# Environment variables
environment:
  # Browser access (web console)
  MINIO_BROWSER: "on"
  # Prometheus metrics
  MINIO_PROMETHEUS_AUTH_TYPE: "public"
  # Server URL for console
  MINIO_SERVER_URL: "http://minio.bocopile.io:9000"
  MINIO_BROWSER_REDIRECT_URL: "http://minio.bocopile.io:9001"

# Init containers (for bucket creation)
# Users will be created via MC (MinIO Client) after installation
